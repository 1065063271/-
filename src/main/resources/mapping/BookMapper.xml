<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.bank.dao.BookMapper" >
  <resultMap id="BaseResultMap" type="com.bank.pojo.Book" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="bookid" property="bookid" jdbcType="INTEGER" />
    <result column="bookname" property="bookname" jdbcType="VARCHAR" />
    <result column="author" property="author" jdbcType="VARCHAR" />
    <result column="printwhere" property="printwhere" jdbcType="VARCHAR" />
    <result column="printdate" property="printdate" jdbcType="DATE" />
    <result column="introduction" property="introduction" jdbcType="VARCHAR" />
    <result column="note" property="note" jdbcType="VARCHAR" />
  </resultMap>
  <select id="Abook" resultType="com.bank.pojo.Book">
    select bookid,bookname from booktable where booktype='A' LIMIT 5;
  </select>
  <select id="Bbook" resultType="com.bank.pojo.Book">
    select bookid,bookname from booktable where booktype='B' LIMIT 5;
  </select>
  <select id="Cbook" resultType="com.bank.pojo.Book">
    select bookid,bookname from booktable where booktype='C' LIMIT 5;
  </select>
  <select id="Dbook" resultType="com.bank.pojo.Book">
    select bookid,bookname from booktable where booktype='D' LIMIT 5;
  </select>
  <select id="Ebook" resultType="com.bank.pojo.Book">
    select bookid,bookname from booktable where booktype='E' LIMIT 5;
  </select>
  <select id="Fbook" resultType="com.bank.pojo.Book">
    select bookid,bookname from booktable where booktype='F' LIMIT 5;
  </select>
  <!--按书名模糊查询-->
  <select id="seltest" parameterType="com.bank.pojo.Selpojo" resultType="com.bank.pojo.Book">/*不能加分号，后面助手要填充limit*/
    select bookid,bookname,introduction,author from booktable where bookname like "%"#{booknamekey}"%"
  </select>
  <!--按类型查询-->

  <!--携带id搜索点击的书籍内容-->
  <select id="selcont" parameterType="int" resultType="com.bank.pojo.Book">
    select * from booktable where bookid=#{bookid};
  </select>
  <!--判断是否第一次评分-->
  <select id="selrate" parameterType="com.bank.pojo.Rate" resultType="com.bank.pojo.Rate">
    select rateid from bookrate where bookid=#{bookid} and readerid=#{readerid};
  </select>
  <!--第一次书籍评分-->
  <insert id="rate" parameterType="com.bank.pojo.Rate">
    insert into bookrate (rate, bookid, readerid) values (#{rate},#{bookid},#{readerid});
  </insert>
  <!--非第一次评分-->
  <update id="updataratet" parameterType="com.bank.pojo.Rate">
    update bookrate set rate=#{rate} where readerid=#{readerid} and bookid=#{bookid};
  </update>
  <!--更新平均评分-->
  <update id="updatarate">
    update booktable set booktable.bookrate=(select avg (rate) from bookrate where booktable.bookid=#{bookid});
  </update>
  <!--对书籍进行评论-->
  <insert id="newcom" parameterType="com.bank.pojo.Comment">
    insert into comment (bookid, readername,comment)
    values (#{bookid},#{readername},#{comment})
  </insert>
  <!--查询本书所有品论-->
  <select id="allcom" parameterType="int" resultType="com.bank.pojo.Comment">
    select comment,readername from comment;
  </select>
  <!--查询书籍鲜花数-->
  <select id="bselflower" parameterType="java.lang.Integer" resultType="java.lang.Integer">
    select flowernum from booktable where bookid=#{bookid};
  </select>
  <!--查询个人鲜花数-->
  <select id="hselflower" parameterType="java.lang.Integer" resultType="java.lang.Integer">
    select flowernum from readertable where readerid=#{readerid};
  </select>
  <!--判断是鲜花数是否为0-->
  <select id="iszero" parameterType="java.lang.Integer" resultType="java.lang.Integer">
    select flowernum from readertable where readerid=#{readerid};
  </select>
  <!--读者赠送鲜花给书籍-->
  <insert id="flowersend" parameterType="com.bank.pojo.Flower">
    insert into flower (bookid, readerid) values (#{bookid},#{readerid});
    update readertable set readertable.flowernum=readertable.flowernum-1 where readerid=#{readerid};
    update booktable set booktable.flowernum=booktable.flowernum+1 where bookid=#{bookid};
  </insert>
</mapper>